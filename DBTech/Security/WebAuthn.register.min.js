var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(c){var d=0;return function(){return d<c.length?{done:!1,value:c[d++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.makeIterator=function(c){var d="undefined"!=typeof Symbol&&Symbol.iterator&&c[Symbol.iterator];return d?d.call(c):$jscomp.arrayIterator(c)};$jscomp.arrayFromIterator=function(c){for(var d,e=[];!(d=c.next()).done;)e.push(d.value);return e};
$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};var DBTech=window.DBTech||{};DBTech.Security=DBTech.Security||{};DBTech.Security.WebAuthn=DBTech.Security.WebAuthn||{};
!function(c,d,e,f){DBTech.Security.WebAuthn.Register=XF.Event.newHandler({eventNameSpace:"DBTechSecurityWebAuthnRegisterClick",options:{form:null,messageBlock:".js-webAuthnError"},$publicKey:null,$message:null,$form:null,initDone:!1,isPending:!1,init:function(){var a=this.$target,b=this.options;publicKey?(b.form&&(a=XF.findRelativeIf(b.form,a)),this.$form=a.closest("form"),this.$message=XF.findRelativeIf(b.messageBlock,a),this.$publicKey=publicKey,this.initPublicKey()):console.error("PublicKey missing from the form")},
initPublicKey:function(){if(!this.initDone){this.$publicKey.challenge=Uint8Array.from(d.atob(this.base64url2base64(this.$publicKey.challenge)),function(b){return b.charCodeAt(0)});this.$publicKey.user.id=Uint8Array.from(d.atob(this.$publicKey.user.id),function(b){return b.charCodeAt(0)});if(this.$publicKey.excludeCredentials){var a=this;this.$publicKey.excludeCredentials=this.$publicKey.excludeCredentials.map(function(b){b.id=Uint8Array.from(d.atob(a.base64url2base64(b.id)),function(b){return b.charCodeAt(0)});
return b})}this.initDone=!0}},click:function(a){if(!this.isPending)if(this.reset(),"https:"!==location.protocol)this.displayError(XF.phrase("dbtech_security_webauthn_requires_ssl"));else if("undefined"===typeof navigator.credentials)this.displayError(XF.phrase("dbtech_security_webauthn_browser_not_supported"));else if(this.initDone){this.setPending();var b=this;navigator.credentials.create({publicKey:publicKey}).then(function(a){a={id:a.id,type:a.type,rawId:b.arrayToBase64String(new Uint8Array(a.rawId)),
response:{clientDataJSON:b.arrayToBase64String(new Uint8Array(a.response.clientDataJSON)),attestationObject:b.arrayToBase64String(new Uint8Array(a.response.attestationObject))}};a=btoa(JSON.stringify(a));b.$form.find('[name="publicKeyCredential"]').val(a);b.$form.submit()})["catch"](function(a){b.displayError(a.message)})}},reset:function(){this.isPending=!1;this.$target.prop("disabled",!1).removeClass("is-disabled");this.$message.html("")},setPending:function(){this.isPending=!0;this.$target.prop("disabled",
!0).addClass("is-disabled")},displayError:function(a){this.isPending=!1;this.$target.prop("disabled",!1).removeClass("is-disabled");this.$message.html(a)},arrayToBase64String:function(a){return btoa(String.fromCharCode.apply(String,$jscomp.arrayFromIterable(a)))},base64url2base64:function(a){a=a.replace(/-/g,"+").replace(/_/g,"/");var b=a.length%4;if(b){if(1===b)throw Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");a+=Array(5-b).join("=")}return a}});XF.Event.register("click",
"dbtech-security-register-key","DBTech.Security.WebAuthn.Register")}(jQuery,window,document);