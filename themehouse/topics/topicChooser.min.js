var themehouse=themehouse||{};themehouse.topics=themehouse.topics||{};
themehouse.topics.topicChooser={init:function(){var a=parseInt($("input[name=topic_id]").val());a?($(".thTopicChooser .topic-filter-item[data-topic-id="+a+"]:not([data-is-additional=1])").length||themehouse.topics.topicChooser.unsetTopic(),$(".thTopicChooser .thTopic--"+a).each(function(){$(this).data("position",$(this).prevAll().length);$(this).appendTo($(this).parent())})):(a=parseInt($(".thTopicChooser .topic-filter-item:not([data-is-additional=1])").data("topicId")),$eles=$(".thTopicChooser .topic-filter-item:not([data-is-additional=1]):not([data-topic-id="+
a+"])"),0===$eles.length&&themehouse.topics.topicChooser.setTopic(a))},setTopic:function(a){var b=$(".thTopicChooser .topic-filter-item[data-topic-id="+a+"]:not([data-is-additional=1])");if(b.length){$("input[name=topic_id]").val(a).trigger("change");$(".thTopicChooser .topic-filter-item[data-topic-id="+a+"]").addClass("topic-filter-item--active");$("input[name=additional_topic_ids]").val(JSON.stringify([]));$chooser=b.closest(".thTopicChooser[data-max-topics=0]");if($chooser.length&&($submit=$(".thTopicChooserSubmit button.button--primary"),
$submit.length)){$submit.click();return}$(".thTopic__createThreadBar__topics").each(function(){$createThreadBarTopic=$(this).find(".thTopic:first");$createThreadBarTopic.addClass("thTopic--"+a);$createThreadBarTopic.html(b.find(".thTopic--title").html());$createThreadBarTopic.attr("data-topic-id",a)});$(".thTopic__createThreadBar").css("display","");$("body").hasClass("is-modalOpen")||$(".thTopic__createThreadBar .th_allTopicsTrigger").click();$(".formRow--thTopics").addClass("formRow--topicSelected");
$(".thTopicChooser .topic-filter-item[data-topic-id="+a+"]").addClass("topic-filter-item--hide");$(".thTopicChooser .topic-filter-item[data-topic-id="+a+"]").each(function(){$(this).data("position",$(this).prevAll().length);$(this).appendTo($(this).parent())});$(".thTopicChooserSubmit").css("display","");if(topicGroupId=b.data("topic-group-id"))$noMultiSelect=$(".thTopicChooser[data-group-multi-select=1] .topic-filter-item[data-topic-group-id="+topicGroupId+"]"),$noMultiSelect.addClass("topic-filter-item--disabled")}},
unsetTopic:function(){var a=$("input[name=topic_id]"),b=a.val();a.val(0);a.data("triggerOnUnset")&&a.trigger("change");$(".thTopic__createThreadBar").css("display","none");$(".thTopic__createThreadBar__topics").each(function(){$(this).find(".thTopic:not(:first)").remove();$createThreadBarTopic=$(this).find(".thTopic:first");$createThreadBarTopic.removeClass("thTopic--"+b);$createThreadBarTopic.html("")});$(".formRow--thTopics").removeClass("formRow--topicSelected");$(".thTopicChooser .topic-filter-item[data-topic-id="+
b+"]").removeClass("topic-filter-item--hide");$(".thTopicChooser .topic-filter-item[data-topic-id="+b+"]").each(function(){$(this).siblings().eq($(this).data("position")).before($(this))});$("input[name=additional_topic_ids]").val(JSON.stringify([]));$(".topic-filter-item").removeClass("topic-filter-item--active");$(".thTopicChooserSubmit").css("display","none");$(".topic-filter-item").removeClass("topic-filter-item--disabled")},addAdditionalTopic:function(a){var b=$(".thTopicChooser .topic-filter-item[data-topic-id="+
a+"][data-is-additional=1]");if(b.length&&!b.hasClass("topic-filter-item--disabled")){var c=JSON.parse($("input[name=additional_topic_ids]").val()).length,d=$(".thTopicChooser[data-max-topics]").data("max-topics");c<d?($(".thTopicChooser .topic-filter-item[data-topic-id="+a+"]").addClass("topic-filter-item--active"),themehouse.topics.topicChooser.refreshAdditionalTopicsInput(),groupId=$(".topic-filter-item[data-topic-id="+a+"]").data("topic-group-id"),0<groupId&&themehouse.topics.topicChooser.checkMultiSelect(groupId),
$(".thTopic__createThreadBar__topics").each(function(){$createThreadBarTopic=$(this).find(".thTopic:first").clone();$createThreadBarTopic.removeClass("thTopic--"+$("input[name=topic_id]").val());$createThreadBarTopic.addClass("thTopic--"+a);$createThreadBarTopic.attr("data-is-additional",1);$createThreadBarTopic.attr("data-topic-id",a);$createThreadBarTopic.attr("data-xf-click","th_topicClick");$createThreadBarTopic.removeAttr("data-href");$createThreadBarTopic.removeAttr("data-node-id");$createThreadBarTopic.html(b.find(".thTopic--title").html());
$createThreadBarTopic.appendTo($(this))})):$(".formRow--topicSelected .block-rowMessage").addClass("block-rowMessage--error");themehouse.topics.topicChooser.checkCreateThreadBarOverflow()}},removeAdditionalTopic:function(a){$(".formRow--topicSelected .block-rowMessage").removeClass("block-rowMessage--error");$(".thTopicChooser .topic-filter-item[data-topic-id="+a+"]").removeClass("topic-filter-item--active");$(".thTopic__createThreadBar__topics .thTopic--"+a).remove();themehouse.topics.topicChooser.refreshAdditionalTopicsInput();
groupId=$(".topic-filter-item[data-topic-id="+a+"]").data("topic-group-id");0<groupId&&themehouse.topics.topicChooser.checkMultiSelect(groupId);themehouse.topics.topicChooser.checkCreateThreadBarOverflow()},refreshAdditionalTopicsInput:function(){var a=$("input[name=topic_id]");a=parseInt(a.val());for(var b=$(".thTopicChooser .topic-filter-item--active"),c=[],d=0,g=b.length;d<g;d++){var e=parseInt(b[d].dataset.topicId,10);e!==a&&-1===c.indexOf(e)&&c.push(e)}$("input[name=additional_topic_ids]").val(JSON.stringify(c))},
checkMultiSelect:function(a){$(".thTopicChooser[data-group-multi-select]").each(function(){if(groupMultiSelect=$(this).data("group-multi-select"))activeCount=$(this).find(".topic-filter-item--active[data-topic-group-id="+a+"]").length,$(this).find(".topic-filter-item--hide[data-topic-group-id="+a+"]").length&&activeCount++,activeCount>=groupMultiSelect?$(this).find(".topic-filter-item[data-topic-group-id="+a+"]:not(.topic-filter-item--active)").addClass("topic-filter-item--disabled"):$(this).find(".topic-filter-item[data-topic-group-id="+
a+"]").removeClass("topic-filter-item--disabled")})},checkCreateThreadBarOverflow:function(){$(".thTopic__createThreadBar__topics").each(function(){$(this).find(".thTopic").css("display","");$(this).parent().find(".thTopic__createThreadBar__topics--plus").html("");if(this.offsetHeight<this.scrollHeight||this.offsetWidth<this.scrollWidth)$additionalTopics=$(this).find(".thTopic:not(:first)"),$additionalTopics.css("display","none"),$(this).parent().find(".thTopic__createThreadBar__topics--plus").html("("+
($additionalTopics.length+1)+")")})}};
!function(a,b,c,d){XF.THTopicClick=XF.Click.newHandler({eventNameSpace:"XFClickTopic",options:{topicId:null,isAdditional:null},init:function(){},click:function(b){b.preventDefault();var e=themehouse.topics.topicChooser,f=this.options.topicId,c=this.options.isAdditional;b=a(b.target).closest(".thTopic, .topic-filter-item");c?b.hasClass("topic-filter-item--active")||b.hasClass("thTopic")?e.removeAdditionalTopic(f):e.addAdditionalTopic(f):b.hasClass("thTopic")?themehouse.topics.topicChooser.unsetTopic(f):themehouse.topics.topicChooser.setTopic(f)}});
XF.THTopicReset=XF.Click.newHandler({eventNameSpace:"XFClickTopic",options:{},init:function(){},click:function(){themehouse.topics.topicChooser.unsetTopic()}});XF.THTopicChooser=XF.Click.newHandler({eventNameSpace:"XFTopicChooser",options:{href:null,nodeId:null},$form:null,loading:!1,init:function(){this.$form=this.$target.closest("form")},click:function(a){if(this.options.href&&(a.preventDefault(),!this.loading)){(a=XF.Element.getHandler(this.$form,"draft"))&&a.triggerSave();this.loading=!0;var b=
this;this.xhr=XF.ajax("post",this.options.href,{topic_id:"",draft_node_id:this.options.nodeId},function(a){"ok"===a.status&&XF.setupHtmlInsert(a.html,function(a,c,d){b.$form.replaceWith(a);XF.activate(a)})})}}});XF.Click.register("th_topicClick","XF.THTopicClick");XF.Click.register("th_topicReset","XF.THTopicReset");XF.Click.register("th_topicChooser","XF.THTopicChooser")}(jQuery,window,document);"complete"===document.readyState&&themehouse.topics.topicChooser.init();$(document).ready(themehouse.topics.topicChooser.init);
$(document.body).on("xf:layout",function(){themehouse.topics.topicChooser.init()});$(window).resize(function(){themehouse.topics.topicChooser.checkCreateThreadBarOverflow()});