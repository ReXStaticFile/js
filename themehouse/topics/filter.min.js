var themehouse=themehouse||{};themehouse.topics=themehouse.topics||{};
themehouse.topics.getActiveForums=function(a){var b=[],c=!1;a=("undefined"===typeof a?$(document):a.closest(".topic-filter-container")).find(".topic-filter-item--active:not(.isCategory).topic-filter-item--node");for(var d=0,e=a.length;d<e;d++){var f=$(a[d]).data("topic-id");-1===b.indexOf(f)&&(b.push(f),-1===themehouse.topics.lastSearchedForums.indexOf(f)&&(c=!0))}themehouse.topics.lastSearchedForums.length!==b.length&&(c=!0);themehouse.topics.lastSearchedForums=b;return{changeMade:c,nodeIds:b}};
themehouse.topics.getActiveTopics=function(a){var b=[],c=!1;a=("undefined"===typeof a?$(document):a.closest(".topic-filter-container")).find(".topic-filter-item--active.topic-filter-item--thread");for(var d=0,e=a.length;d<e;d++){var f=$(a[d]).data("topic-id");-1===b.indexOf(f)&&(b.push(f),-1===themehouse.topics.lastSearchedTopics.indexOf(f)&&(c=!0))}themehouse.topics.lastSearchedTopics.length!==b.length&&(c=!0);themehouse.topics.lastSearchedTopics=b;return{changeMade:c,topicIds:b}};
themehouse.topics.fetchThreads=function(a){var b=$(".filterBar-menuTrigger");var c=(filterMenuId=b.attr("aria-controls"))?$("#"+filterMenuId):b.siblings("[data-menu=menu]");if(!c.length)return!1;$form=c.find("form");var d=themehouse.topics.getActiveForums(a),e=d.nodeIds,f=$(".th_topics__clearTopics__wrapper[data-topic-type=node]");f.length&&(2<=e.length?f.addClass("thTopics__filterBar--activeFilter"):f.removeClass("thTopics__filterBar--activeFilter"));a=themehouse.topics.getActiveTopics(a);var g=
a.topicIds;f=$(".th_topics__clearTopics__wrapper[data-topic-type=thread]");f.length&&(2<=g.length?f.addClass("thTopics__filterBar--activeFilter"):f.removeClass("thTopics__filterBar--activeFilter"));if(a.changeMade||d.changeMade)$filterBar=b.closest(".block-filterBar"),$container=$filterBar.closest(".block-container"),$container.siblings(".block-outer.block-outer--after").empty(),$container.children(":not(.block-filterBar)").empty(),$container.siblings(".block-outer:not(.block-outer--after)").css("visibility",
"hidden"),this.xhr&&this.xhr.abort(),$form.length&&themehouse.topics.submitFilterForm($form,g,e),c=c.data("href"),this.xhr=XF.ajax("get",c,{},function(a){"ok"===a.status&&(a=$(a.html.content).filter("form"),themehouse.topics.submitFilterForm(a,g,e))});return!0};
themehouse.topics.submitFilterForm=function(a,b,c){var d=a.attr("action");a=XF.getDefaultFormData(a);a.append("topics",b.join(","));a.append("forums",c.join(","));var e=this;this.xhr=XF.ajax("post",d,a,function(a){if(a.redirect){var d=a.redirect;e.xhr=XF.ajax("post",d,{topics:b.join(","),forums:c.join(",")},function(a){a.redirect||"ok"!==a.status||(themehouse.topics.setupHtmlInsert(a,$container),window.history.pushState(null,null,d));return!1})}else"ok"===a.status&&(themehouse.topics.setupHtmlInsert(a,
$filterBar),"undefined"!==typeof a.href&&themehouse.topics.pushState(a,b));return!1},{skipDefaultSuccess:!0})};themehouse.topics.setupHtmlInsert=function(a,b){XF.setupHtmlInsert(a.html,function(){var c=$(a.html.content).find(".filterBar-menuTrigger").closest(".block");b.closest(".block").replaceWith(c);XF.activate(c);themehouse.topics.initItemClicks()})};
themehouse.topics.pushState=function(a,b){if(0===b.length){var c=a.href,d=a.href.split("&");2===d.length&&(c=d[0]);window.history.pushState(null,null,c)}else window.history.pushState(null,null,a.href)};
themehouse.topics.checkCategories=function(){$(".topic-filter-container .topic-filter-item.isCategory").each(function(){var a=$(this).data("topic-id");$('.topic-filter-container .topic-filter-item:not(.isCategory)[data-parent-topic-id="'+a+'"]').length&&(themehouse.topics.isForumChildrenActive(a)?themehouse.topics.makeCategoryActive(a):themehouse.topics.makeCategoryInactive(a))})};
themehouse.topics.makeCategoryActive=function(a){$('.topic-filter-container .topic-filter-item.isCategory[data-topic-id="'+a+'"]').addClass("topic-filter-item--active");(a=$('.topic-filter-container .topic-filter-item.isCategory[data-topic-id="'+a+'"]').data("parent-topic-id"))&&themehouse.topics.isForumChildrenActive(a)&&themehouse.topics.makeCategoryActive(a)};
themehouse.topics.makeCategoryInactive=function(a){$('.topic-filter-container .topic-filter-item.isCategory[data-topic-id="'+a+'"]').removeClass("topic-filter-item--active");(a=$('.topic-filter-container .topic-filter-item.isCategory[data-topic-id="'+a+'"]').data("parent-topic-id"))&&themehouse.topics.makeCategoryInactive(a)};
themehouse.topics.isForumChildrenActive=function(a){var b=$('.topic-filter-container .topic-filter-item:not(.isCategory)[data-parent-topic-id="'+a+'"]');a=$('.topic-filter-container .topic-filter-item:not(.isCategory)[data-parent-topic-id="'+a+'"].topic-filter-item--active');if(b.length!==a.length)return!1;b.each(function(){var a=$(this).data("topic-id");if(!themehouse.topics.isForumChildrenActive(a))return!1});return!0};
themehouse.topics.nodeItemClick=function(a){var b=$(a.target),c=b.closest(".topic-filter-item"),d=c.data("topic-id"),e=null;b=b.closest(".topic-filter-container");b.length&&(e=b.data("max-depth"));!c.hasClass("isCategory")&&c.hasClass("topic-filter-item--active")?($('.topic-filter-container .topic-filter-item.topic-filter-item--node[data-topic-id="'+d+'"], .block-filterBar .topic-filter-item.topic-filter-item--node[data-topic-id="'+d+'"]').removeClass("topic-filter-item--active"),null!==e&&c.hasClass("thForum--depth-"+
(e-1))&&themehouse.topics.removeChildNodes(d)):c.hasClass("isCategory")&&c.hasClass("topic-filter-item--active")?themehouse.topics.removeChildNodes(d):(c.hasClass("isCategory")||$('.topic-filter-container .topic-filter-item.topic-filter-item--node[data-topic-id="'+d+'"], .block-filterBar .topic-filter-item:not(.isCategory).topic-filter-item--node[data-topic-id="'+d+'"]').addClass("topic-filter-item--active"),(c.hasClass("isCategory")||null!==e&&c.hasClass("thForum--depth-"+(e-1)))&&themehouse.topics.addChildNodes(d));
themehouse.topics.checkCategories();themehouse.topics.fetchThreads()&&(a.preventDefault(),a.stopPropagation())};
themehouse.topics.removeChildNodes=function(a){var b=[];$('.topic-filter-container .topic-filter-item.topic-filter-item--node[data-parent-topic-id="'+a+'"]').each(function(){var a=$(this).data("topic-id");-1===b.indexOf(a)&&b.push(a)});a=0;for(var c=b.length;a<c;a++){var d=b[a];$('.topic-filter-container .topic-filter-item.topic-filter-item--node[data-topic-id="'+d+'"], .block-filterBar .topic-filter-item.topic-filter-item--node[data-topic-id="'+d+'"]').removeClass("topic-filter-item--active");themehouse.topics.removeChildNodes(d)}};
themehouse.topics.addChildNodes=function(a){var b=[];$('.topic-filter-container .topic-filter-item.topic-filter-item--node[data-parent-topic-id="'+a+'"]').each(function(){var a=$(this).data("topic-id");-1===b.indexOf(a)&&b.push(a)});a=0;for(var c=b.length;a<c;a++){var d=b[a];$('.topic-filter-container .topic-filter-item.topic-filter-item--node[data-topic-id="'+d+'"], .block-filterBar .topic-filter-item:not(.isCategory).topic-filter-item--node[data-topic-id="'+d+'"]').addClass("topic-filter-item--active");
themehouse.topics.addChildNodes(d)}};
themehouse.topics.topicItemClick=function(a){var b=$(a.target),c=b.closest(".topic-filter-item"),d=c.data("topic-id"),e=[];if(b=b.closest(".topic-filter-container").hasClass("topic-filter-disableMultiSelect")){var f=c.data("parent-topic-id");f&&-1===e.indexOf(f)&&e.push(f)}c.hasClass("topic-filter-item--active")?($('.topic-filter-container .topic-filter-item.topic-filter-item--thread[data-parent-topic-id="'+d+'"]').removeClass("topic-filter-item--parentActive"),b?$(".topic-filter-container .topic-filter-item--active.topic-filter-item--thread, .block-filterBar .topic-filter-item--active.topic-filter-item--thread").removeClass("topic-filter-item--active"):
$('.topic-filter-container .topic-filter-item--active.topic-filter-item--thread[data-topic-id="'+d+'"], .block-filterBar .topic-filter-item.topic-filter-item--active.topic-filter-item--thread[data-topic-id="'+d+'"]').removeClass("topic-filter-item--active")):(b&&($(".topic-filter-container .topic-filter-item--active.topic-filter-item--thread, .block-filterBar .topic-filter-item--active.topic-filter-item--thread").removeClass("topic-filter-item--active"),$(".topic-filter-container .topic-filter-item--parentActive.topic-filter-item--thread").removeClass("topic-filter-item--parentActive")),
$('.topic-filter-container .topic-filter-item.topic-filter-item--thread[data-topic-id="'+d+'"], .block-filterBar .topic-filter-item:not(.isCategory).topic-filter-item--thread[data-topic-id="'+d+'"]').addClass("topic-filter-item--active"),$('.topic-filter-container .topic-filter-item.topic-filter-item--thread[data-parent-topic-id="'+d+'"]').addClass("topic-filter-item--parentActive"));c=0;for(d=e.length;c<d;c++)b=e[c],$('.topic-filter-container .topic-filter-item.topic-filter-item--thread[data-topic-id="'+
b+'"], .block-filterBar .topic-filter-item:not(.isCategory).topic-filter-item--thread[data-topic-id="'+b+'"]').addClass("topic-filter-item--active"),$('.topic-filter-container .topic-filter-item.topic-filter-item--thread[data-parent-topic-id="'+b+'"]').addClass("topic-filter-item--parentActive");themehouse.topics.fetchThreads()&&(a.preventDefault(),a.stopPropagation())};
themehouse.topics.initItemClicks=function(){var a=$(".topic-filter-container .topic-filter-item.topic-filter-item--node, .block-filterBar .topic-filter-item.topic-filter-item--node");a.off("click");a.click(function(a){themehouse.topics.nodeItemClick(a)});a=$(".topic-filter-container .topic-filter-item.topic-filter-item--thread, .block-filterBar .topic-filter-item.topic-filter-item--thread");a.off("click");a.click(function(a){themehouse.topics.topicItemClick(a)});a=$(".structItem-topicsForumTitle a");
a.off("click");a.click(function(a){var b=$(a.target).data("topic-id");$(".topic-filter-container .topic-filter-item--active.topic-filter-item--node, .block-filterBar .topic-filter-item--active.topic-filter-item--node").removeClass("topic-filter-item--active");$('.topic-filter-container .topic-filter-item.topic-filter-item--node[data-topic-id="'+b+'"], .block-filterBar .topic-filter-item:not(.isCategory).topic-filter-item--node[data-topic-id="'+b+'"]').addClass("topic-filter-item--active");themehouse.topics.fetchThreads()&&
a.preventDefault();themehouse.topics.checkCategories()});a=$(".structItem-topicList__inner .thTopic");a.off("click");a.click(function(a){var b=$(a.target).closest(".thTopic").data("topic-id");$(".topic-filter-container .topic-filter-item--active.topic-filter-item--thread, .block-filterBar .topic-filter-item--active.topic-filter-item--thread").removeClass("topic-filter-item--active");$('.topic-filter-container .topic-filter-item.topic-filter-item--thread[data-topic-id="'+b+'"], .block-filterBar .topic-filter-item:not(.isCategory).topic-filter-item--thread[data-topic-id="'+
b+'"]').addClass("topic-filter-item--active");themehouse.topics.fetchThreads()&&a.preventDefault()});a=$("[data-topic-type=node] .th_topics_clearTopics");a.off("click");a.click(function(a){$(".topic-filter-container .topic-filter-item--active.topic-filter-item--node, .block-filterBar .topic-filter-item--active.topic-filter-item--node").removeClass("topic-filter-item--active");themehouse.topics.fetchThreads()&&a.preventDefault();themehouse.topics.checkCategories()});a=$("[data-topic-type=thread] .th_topics_clearTopics");
a.off("click");a.click(function(a){$(".topic-filter-container .topic-filter-item--active.topic-filter-item--thread, .block-filterBar .topic-filter-item--active.topic-filter-item--thread").removeClass("topic-filter-item--active");themehouse.topics.fetchThreads()&&a.preventDefault();"undefined"!==typeof themehouse.topics.topicChooser&&themehouse.topics.topicChooser.unsetTopic()});"undefined"===typeof themehouse.topics.lastSearchedForums&&(themehouse.topics.lastSearchedForums=[],themehouse.topics.getActiveForums());
"undefined"===typeof themehouse.topics.lastSearchedTopics&&(themehouse.topics.lastSearchedTopics=[],themehouse.topics.getActiveTopics())};
themehouse.topics.initWidgets=function(){$("[data-widget-definition=thtopics_thread_filter]").each(function(){var a=$(this),b=a.data("topicType"),c=$(".filterBar-filters .topic-filter-item[data-topic-type="+b+"]");c.length&&((a.closest(".p-body-sidebar").length||a.closest(".p-body-sideNav").length)&&!a.data("style")||"simple_vertical"===a.data("style")?(a.addClass("block").addClass("topic-filter-simple"),a.find(".topic-filter-container").addClass("block-container"),a.find(".topic-filter-body").addClass("block-body"),
a.find(".topic-filter-footer").addClass("block-footer"),a.find(".topic-filter-item").addClass("block-row"),$("html").addClass("has-simpleverticaltopics")):(a.addClass("block"),a.find(".topic-filter-container").addClass("topic-filter-scroller"),$body=a.find(".topic-filter-body"),$body.addClass("hScroller").attr("data-xf-init","h-scroller"),$body.children("div").addClass("hScroller-scroll"),$("html").addClass("has-horizontalscrollertopics"),XF.activate($body)),a.find(".topic-filter-item").each(function(){var a=
$(this),b=a.data("topicId");b=c.filter("[data-topic-id="+b+"]");b.length?(a.addClass(b.attr("class")),b=b.text().trim(),a.find(".thTopic--title").text(b),a.css("display","")):a.remove()}),a.show())})};themehouse.topics.initAll=function(){themehouse.topics.initWidgets();themehouse.topics.initItemClicks();themehouse.topics.checkCategories();var a=$(document);a.off("xf:layout");a.on("xf:layout",function(){$(".overlay-container.is-active .thTopicList").length&&themehouse.topics.initAll()})};
"complete"===document.readyState&&themehouse.topics.initAll();$(document).ready(themehouse.topics.initAll);