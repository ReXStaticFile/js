!function(l){XF.PostReply_ReplyClick=XF.Event.newHandler({eventNameSpace:"PostReply_ReplyClick",options:{formUrl:null,messageSelector:null},loading:!1,formHtml:null,$container:null,$close:null,init:function(){this.$close=l("<button />").addClass(["button","button--iconOnly","button--icon"].join(" ")).attr("type","button"),this.$close.html('<span class="button-text"><i class="fa fa-times" aria-hidden="true"></i></span>')},click:function(t){if(t.preventDefault(),this.loading||this.formHtml)this.$container&&(this.$container.show(),XF.focusEditor(this.$container));else{this.loading=!0;for(var n=null,e=10,i=0,o=0;0<e&&(e--,(n=null===n?this.$target.closest(".js-tprReplyMessageContainer"):XF.findRelativeIf("<:up(5)",n)).hasClass("js-tprReplyMessageContainer"));)i++;0<(t=1<i?this.$target.closest(".js-tprReplyMessageContainer").find(">.js-post"):XF.findRelativeIf(this.options.messageSelector,this.$target).find(".js-post")).length&&(2<=(t=t.last().data("content").split("-")).length&&(o=t[1]));var s=this;XF.ajax("POST",this.options.formUrl,{last_post:o},function(e){s.formHtml=e.html,!s.$container&&e.hasOwnProperty("formHolder")&&(s.$container=l(e.formHolder)),s.$container.empty().show(),XF.setupHtmlInsert(e.html,function(t){var n=s.$close.clone();n.on("click",function(){s.$container.hide()}),n.appendTo(t.find(".formButtonGroup-primary")),t.appendTo(s.$container),setTimeout(function(){s.setupComplete(t,e)},XF.config.speed.xxfast)})}).always(function(){s.loading=!1})}},setupComplete:function(t,n){n.hasOwnProperty("mentionUser")&&n.mentionUser&&XF.replaceEditorContent(this.$container,n.mentionUser+"<span> </span>",n.mentionUser+" "),XF.focusEditor(this.$container)}}),XF.PostReply_LoadReplies=XF.Event.newHandler({eventNameSpace:"PostReply_LoadReplies",options:{link:null,messageSelector:null,sibling:0},link:null,loading:!1,init:function(){if(this.link=this.options.link||this.$target.attr("href"),!this.link)throw new Error("No link for load")},click:function(t){t.preventDefault();for(var n=[],e=this,i=XF.findRelativeIf(this.options.messageSelector,this.$target),o=0;o<i.length;o++){var s=l(i[o]).data("content").split("-");2<=s.length&&n.push(s[1])}this.loading||(this.loading=!0,t={skip_ids:n.join(","),sibling:this.options.sibling},XF.ajax("POST",this.link,t,XF.proxy(this,"onResponse")).always(function(){e.loading=!1}))},onResponse:function(t){t.hasOwnProperty("hasMore")&&t.hasMore||this.$target.hide();var n=this;XF.setupHtmlInsert(t.html,function(t){t.insertAfter(n.$target)})}}),XF.PostReply_ExpandQuote=XF.Event.newHandler({eventNameSpace:"PostReply_ExpandQuote",options:{content:null},$content:null,init:function(){this.$content=XF.findRelativeIf(this.options.content,this.$target)},click:function(t){t.preventDefault(),this.$content.show()}}),XF.Event.register("click","tpr-load-replies","XF.PostReply_LoadReplies"),XF.Event.register("click","tpr-post-reply","XF.PostReply_ReplyClick"),XF.Event.register("click","tpr-expand-quote","XF.PostReply_ExpandQuote")}(jQuery,document);