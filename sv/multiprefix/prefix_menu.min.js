var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,e,c){b instanceof String&&(b=String(b));for(var f=b.length,a=0;a<f;a++){var d=b[a];if(e.call(c,d,a,b))return{i:a,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,c){b!=Array.prototype&&b!=Object.prototype&&(b[e]=c.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,e,c,f){if(e){c=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var a=b[f];a in c||(c[a]={});c=c[a]}b=b[b.length-1];f=c[b];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,c){return $jscomp.findInternal(this,b,c).v}},"es6","es3");var SV=window.SV||{};SV.MultiPrefix=SV.MultiPrefix||{};
(function(b,e,c,f){b.extend(SV.MultiPrefix,{svMultiPrefixCounter:1});b.fn.extend({multiPrefixSelectorUniqueId:function(){var a=this.attr("id");a||(a="js-SVMultiPrefixUniqueId"+SV.MultiPrefix.svMultiPrefixCounter,this.attr("id",a),this.attr("data-sv-multiprefix-unique",SV.MultiPrefix.svMultiPrefixCounter),SV.MultiPrefix.svMultiPrefixCounter++);return a}});SV.MultiPrefix.PrefixMenu=XF.Element.newHandler({options:{realInput:null},hiddenTarget:null,onChangeHack:null,init:function(){var a=this.$target;
this.template=this.$target.parent().find('script[type="text/template"]').html();this.template||(console.error("No prefix template could be found"),this.template="");a.on("config-update",b.proxy(this,"initSelect2"));a.on("select2:unselecting",function(a){XF.MenuWatcher.preventDocClick()});a.on("select2:unselect",function(a){setTimeout(function(){XF.MenuWatcher.allowDocClick()},0)});var d=a.closest(".overlay-container");if(d.length)d.on("overlay:hiding",function(){a.select2("close")});a.trigger("config-update")},
loadPrefixes:function(a){var d=[];a.find("option").each(function(){var a=b(this);d[a.attr("value")]={prefix_id:a.attr("value"),title:a.text(),css_class:a.attr("data-prefix-class")}});this.prefixes=d},initSelect2:function(){var a=this.$target,d={width:"100%",minimumSelectionLength:parseInt(a.data("min-tokens"),10),maximumSelectionLength:parseInt(a.data("max-tokens"),10),containerCssClass:"input prefix--title",selectOnClose:!1,placeholder:XF.phrase("sv_prefix_placeholder",null,"Prefix..."),disabled:a.prop("disabled"),
templateResult:b.proxy(this,"renderPrefix"),templateSelection:b.proxy(this,"renderPrefix"),dropdownParent:a.parent(),debug:!1},h=a.val();"string"===typeof h&&(h=null);var c=d.maximumSelectionLength;h=h&&c&&h.length>c;var e=!1,f=a.find('option[value="0"]');h||1!==c?(f.remove(),a.attr("multiple","multiple")):(d.minimumSelectionLength=void 0,d.maximumSelectionLength=void 0,f.length||a.prepend(b('<option value="0" data-prefix-class="label" />').text(XF.phrase("sv_multiprefix_none",null,"(None)"))),e=
!0,c=a.attr("name"),a.attr("name",c+"_original"),this.hiddenTarget=b("<input>").attr({type:"hidden",name:c,id:a.attr("id")+"_hidden"}).insertAfter(a));this.loadPrefixes(a);a.multiPrefixSelectorUniqueId();a.data("select2")&&a.select2("destroy");var g=a.select2(d);this.onChangeHack&&(g.off("change",this.onChangeHack),this.onChangeHack=null);if(e){var k=this.hiddenTarget;this.onChangeHack=function(a){k.val(g.val()).trigger("select2:select");k.trigger("change",a);g.val("")};g.on("change",this.onChangeHack);
this.onChangeHack();d=g.data("select2");this.$container=d.$container;this.$selection=d.$selection;d.on("results:message",function(a){this.dropdown._resizeDropdown();this.dropdown._positionDropdown()});a.attr("autofocus")&&(g.select2("open"),d.$selection.addClass("is-focused"));a=g.closest(".overlay-container");if(a.length)a.on("overlay:hiding",function(){g.select2("close")})}h&&b(".select2-search__field").click()},renderPrefix:function(a){return a.id&&""!==this.template?b(Mustache.render(this.template,
{rich_prefix:this.prefixes[a.id]})):a.text}});SV.MultiPrefix.PrefixLoader=XF.Element.newHandler({options:{listenTo:"",initUpdate:!0,href:"",uniqueId:""},init:function(){if(this.$target.is("select")){if(this.options.uniqueId=this.$target.multiPrefixSelectorUniqueId(),this.options.href){var a=this.options.listenTo?XF.findRelativeIf(this.options.listenTo,this.$target):b([]);a.length?(a.on("change",b.proxy(this,"loadPrefixes")),this.options.initUpdate&&a.trigger("change")):console.error("Cannot load prefixes dynamically as no element set to listen to for changes")}}else console.error("Must trigger on select")},
loadPrefixes:function(a){XF.ajax("POST",this.options.href,{val:b(a.target).val()},b.proxy(this,"loadSuccess"))},loadSuccess:function(a){if(a.html){var d="js-SVMultiPrefixUniqueId"+parseInt(this.$target.attr("data-sv-multiprefix-unique"),10),c=b("#"+d);d=b("#"+d+"_hidden");d.length&&(c.data("select2")&&c.select2("destroy"),c.val(d.val().split(",")),c.attr("name",d.attr("name")),d.remove());var e=c.val();"string"===typeof e&&(e=[e]);XF.setupHtmlInsert(a.html,function(a){a.each(function(){var a=b(this).find("select");
if(a.length){c.empty().append(a.children());e?b.each(e,function(a,b){c.find('option[value="'+b+'"]').prop("selected",!0)}):c.find("option").first().prop("checked",!0);var d=a.data("min-tokens");a=a.data("max-tokens");c.data("min-tokens",d).attr("data-max-tokens",a).data("max-tokens",a).attr("data-min-tokens",d);c.find("option:selected");c.trigger("config-update");return!1}});a.empty()})}}});XF.QuickThread&&XF.Element.extend("quick-thread",{__backup:{reset:"svMultiPrefix_reset"},reset:function(a,c){b('select[name="prefix_id[]"]').val("").trigger("change");
this.svMultiPrefix_reset(a,c)}});XF.Element.register("sv-multi-prefix-loader","SV.MultiPrefix.PrefixLoader");XF.Element.register("sv-multi-prefix-menu","SV.MultiPrefix.PrefixMenu")})(jQuery,window,document);
