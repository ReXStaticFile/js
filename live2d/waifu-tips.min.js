/*
 * Live2D Code
 * Written & Modified by NULPLX.
 * Under GPLv3 License.
 * ReX Wear Only.
 */

function loadWidget(e){let{waifuPath:a,apiPath:s,cdnPath:o}=e;let n=false,l;if(typeof o==="string"){n=true;if(!o.endsWith("/"))o+="/"}else if(typeof s==="string"){if(!s.endsWith("/"))s+="/"}else{console.error("Invalid initWidget argument!");return}localStorage.removeItem("waifu-display");sessionStorage.removeItem("waifu-text");document.body.insertAdjacentHTML("beforeend",`<div id="waifu"><div id="waifu-tips"></div><canvas id="live2d" width="800" height="800"></canvas><div id="waifu-tool"><span class="fa fa-lg fa-comment"></span><span class="fa fa-lg fa-paper-plane"></span><span class="fa fa-lg fa-user-circle"></span><span class="fa fa-lg fa-camera-retro"></span><span class="fa fa-lg fa-info-circle"></span><span class="fa fa-lg fa-times"></span></div></div>`);setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0);function d(e){return Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e}let t=false,i,r,c=["好久不见，日子过得好快呢……","大坏蛋！你都多久没理人家了呀，嘤嘤嘤～","嗨～快来逗我玩吧！","拿小拳拳锤你胸口！","记得把小家加入 Adblock 白名单哦！"];window.addEventListener("mousemove",()=>t=true);window.addEventListener("keydown",()=>t=true);setInterval(()=>{if(t){t=false;clearInterval(i);i=null}else if(!i){i=setInterval(()=>{u(d(c),6e3,9)},2e4)}},1e3);(function e(){document.querySelector("#waifu-tool .fa-comment").addEventListener("click",f);document.querySelector("#waifu-tool .fa-paper-plane").addEventListener("click",()=>{if(window.Asteroids){if(!window.ASTEROIDSPLAYERS)window.ASTEROIDSPLAYERS=[];window.ASTEROIDSPLAYERS.push(new Asteroids)}else{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/gh/stevenjoezhang/asteroids/asteroids.js";document.head.appendChild(e)}});document.querySelector("#waifu-tool .fa-user-circle").addEventListener("click",w);document.querySelector("#waifu-tool .fa-camera-retro").addEventListener("click",()=>{u("照好了嘛，是不是很可爱呢？",6e3,9);Live2D.captureName="photo.png";Live2D.captureFrame=true});document.querySelector("#waifu-tool .fa-info-circle").addEventListener("click",()=>{open("https://github.com/nu11plex/")});document.querySelector("#waifu-tool .fa-times").addEventListener("click",()=>{localStorage.setItem("waifu-display",Date.now());u("愿你有一天能与重要的人重逢。",2e3,11);document.getElementById("waifu").style.bottom="-500px";setTimeout(()=>{document.getElementById("waifu").style.display="none";document.getElementById("waifu-toggle").classList.add("waifu-toggle-active")},3e3)});const t=()=>{};console.log("%c",t);t.toString=()=>{u("哈哈，你打开了控制台，是想要看看我的小秘密吗？",6e3,9)};window.addEventListener("copy",()=>{u("你都复制了些什么呀，转载要记得加上出处哦！",6e3,9)});window.addEventListener("visibilitychange",()=>{if(!document.hidden)u("哇，你终于回来了～",6e3,9)})})();(function e(){let t;if(location.pathname==="/"){const i=(new Date).getHours();if(i>5&&i<=7)t="早上好！一日之计在于晨，美好的一天就要开始了。";else if(i>7&&i<=11)t="上午好！工作顺利嘛，不要久坐，多起来走动走动哦！";else if(i>11&&i<=13)t="中午了，工作了一个上午，现在是午餐时间！";else if(i>13&&i<=17)t="午后很容易犯困呢，今天的运动目标完成了吗？";else if(i>17&&i<=19)t="傍晚了！窗外夕阳的景色很美丽呢，最美不过夕阳红～";else if(i>19&&i<=21)t="晚上好，今天过得怎么样？";else if(i>21&&i<=23)t=["已经这么晚了呀，早点休息吧，晚安～","深夜时要爱护眼睛呀！"];else t="你是夜猫子呀？这么晚还不睡觉，明天起的来嘛？"}else if(document.referrer!==""){const a=new URL(document.referrer),s=a.hostname.split(".")[1];if(location.hostname===a.hostname)t=`欢迎阅读<span>「${document.title.split(" - ")[0]}」</span>`;else if(s==="baidu")t=`Hello！来自 百度搜索 的朋友<br>你是搜索 <span>${a.search.split("&wd=")[1].split("&")[0]}</span> 找到的我吗？`;else if(s==="so")t=`Hello！来自 360搜索 的朋友<br>你是搜索 <span>${a.search.split("&q=")[1].split("&")[0]}</span> 找到的我吗？`;else if(s==="google")t=`Hello！来自 谷歌搜索 的朋友<br>欢迎阅读<span>「${document.title.split(" - ")[0]}」</span>`;else t=`Hello！来自 <span>${a.hostname}</span> 的朋友`}else{t=`欢迎阅读<span>「${document.title.split(" - ")[0]}」</span>`}u(t,7e3,8)})();function f(){fetch("https://v1.hitokoto.cn").then(e=>e.json()).then(e=>{const t=`这句一言来自 <span>「${e.from}」</span>，是 <span>${e.creator}</span> 在 hitokoto.cn 投稿的。`;u(e.hitokoto,6e3,9);setTimeout(()=>{u(t,4e3,9)},6e3)})}function u(e,t,i){if(!e||sessionStorage.getItem("waifu-text")&&sessionStorage.getItem("waifu-text")>i)return;if(r){clearTimeout(r);r=null}e=d(e);sessionStorage.setItem("waifu-text",i);const a=document.getElementById("waifu-tips");a.innerHTML=e;a.classList.add("waifu-tips-active");r=setTimeout(()=>{sessionStorage.removeItem("waifu-text");a.classList.remove("waifu-tips-active")},t)}(function e(){let t=localStorage.getItem("modelId"),i=localStorage.getItem("modelTexturesId");if(t===null){t=1;i=53}g(t,i);fetch(a).then(e=>e.json()).then(a=>{window.addEventListener("mouseover",i=>{for(let{selector:e,text:t}of a.mouseover){if(!i.target.matches(e))continue;t=d(t);t=t.replace("{text}",i.target.innerText);u(t,4e3,8);return}});window.addEventListener("click",i=>{for(let{selector:e,text:t}of a.click){if(!i.target.matches(e))continue;t=d(t);t=t.replace("{text}",i.target.innerText);u(t,4e3,8);return}});a.seasons.forEach(({date:e,text:t})=>{const i=new Date,a=e.split("-")[0],s=e.split("-")[1]||a;if(a.split("/")[0]<=i.getMonth()+1&&i.getMonth()+1<=s.split("/")[0]&&(a.split("/")[1]<=i.getDate()&&i.getDate()<=s.split("/")[1])){t=d(t);t=t.replace("{year}",i.getFullYear());c.push(t)}})})})();async function m(){const e=await fetch(`https://rexwear.cn/js/live2d/model_list.json`);l=await e.json()}async function g(e,t,i){localStorage.setItem("modelId",e);localStorage.setItem("modelTexturesId",t);u(i,4e3,10);if(n){if(!l)await m();const a=d(l.models[e]);loadlive2d("live2d",`${o}model/${a}/index.json`)}else{loadlive2d("live2d",`${s}get/?id=${e}-${t}`);console.log(`Live2D 模型 ${e}-${t} 加载完成`)}}async function p(){const t=localStorage.getItem("modelId"),i=localStorage.getItem("modelTexturesId");if(n){if(!l)await m();const e=d(l.models[t]);loadlive2d("live2d",`${o}model/${e}/index.json`);u("我的新衣服好看嘛？",4e3,10)}else{fetch(`${s}rand_textures/?id=${t}-${i}`).then(e=>e.json()).then(e=>{if(e.textures.id===1&&(i===1||i===0))u("我还没有其他衣服呢！",4e3,10);else g(t,e.textures.id,"我的新衣服好看嘛？")})}}async function w(){let e=localStorage.getItem("modelId");if(n){if(!l)await m();const t=++e>=l.models.length?0:e;g(t,0,l.messages[t])}else{fetch(`${s}switch/?id=${e}`).then(e=>e.json()).then(e=>{g(e.model.id,0,e.model.message)})}}}function initWidget(e,t){if(typeof e==="string"){e={waifuPath:e,apiPath:t}}document.body.insertAdjacentHTML("beforeend",`<div id="waifu-toggle"><span>看板娘</span></div>`);const i=document.getElementById("waifu-toggle");i.addEventListener("click",()=>{i.classList.remove("waifu-toggle-active");if(i.getAttribute("first-time")){loadWidget(e);i.removeAttribute("first-time")}else{localStorage.removeItem("waifu-display");document.getElementById("waifu").style.display="";setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0)}});if(localStorage.getItem("waifu-display")&&Date.now()-localStorage.getItem("waifu-display")<=864e5){i.setAttribute("first-time",true);setTimeout(()=>{i.classList.add("waifu-toggle-active")},0)}else{loadWidget(e)}}